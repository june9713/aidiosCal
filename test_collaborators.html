<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공동작업자 기능 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
        .result-area {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            min-height: 100px;
        }
        .schedule-info-table {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 0;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            overflow: hidden;
            margin-top: 20px;
        }
        .schedule-info-label {
            font-weight: 600;
            color: #000;
            padding: 6px 12px;
            border-bottom: 1px solid #dee2e6;
            border-right: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            font-size: 13px;
            line-height: 1.2;
            min-height: 32px;
            background: #e9ecef;
        }
        .schedule-info-value {
            padding: 6px 12px;
            color: #000;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            font-size: 13px;
            line-height: 1.2;
            min-height: 32px;
            background: white;
        }
        .schedule-info-value:last-of-type,
        .schedule-info-label:last-of-type {
            border-bottom: none;
        }
        .collaborator-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .collaborator-item:last-child {
            border-bottom: none;
        }
        .collaborator-name {
            font-weight: 500;
            color: #333;
            min-width: 80px;
        }
        .collaborator-role {
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        .collaborator-permissions {
            color: #666;
            font-size: 11px;
            font-style: italic;
        }
        .no-collaborators {
            color: #999;
            font-style: italic;
            font-size: 12px;
        }
        .loading-collaborators {
            color: #666;
            font-style: italic;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>공동작업자 기능 테스트</h1>
        
        <div class="test-section">
            <h3>1. 공동작업자 렌더링 테스트</h3>
            <button class="test-button" onclick="testRenderCollaborators()">공동작업자 렌더링 테스트</button>
            <div class="result-area" id="render-test-result">
                결과가 여기에 표시됩니다.
            </div>
        </div>

        <div class="test-section">
            <h3>2. 스케줄 상세 정보 테스트</h3>
            <button class="test-button" onclick="testScheduleDetail()">스케줄 상세 정보 테스트</button>
            <div class="result-area" id="schedule-detail-result">
                결과가 여기에 표시됩니다.
            </div>
        </div>

        <div class="test-section">
            <h3>3. API 호출 시뮬레이션</h3>
            <button class="test-button" onclick="testAPICall()">API 호출 시뮬레이션</button>
            <div class="result-area" id="api-test-result">
                결과가 여기에 표시됩니다.
            </div>
        </div>
    </div>

    <script>
        // 공동작업자 렌더링 함수 (main.js에서 가져온 것)
        function renderCollaboratorsForModal(collaborators, scheduleId) {
            const collaboratorsList = document.getElementById('collaborators-list');
            if (!collaboratorsList) return;
            
            if (collaborators.length === 0) {
                collaboratorsList.innerHTML = '<span class="no-collaborators">공동작업자가 없습니다</span>';
                return;
            }
            
            const collaboratorsHtml = collaborators.map(collaborator => {
                const permissions = [];
                if (collaborator.can_edit) permissions.push('수정');
                if (collaborator.can_delete) permissions.push('삭제');
                if (collaborator.can_complete) permissions.push('완료');
                if (collaborator.can_share) permissions.push('공유');
                
                const permissionsText = permissions.length > 0 ? ` (${permissions.join(', ')})` : '';
                
                return `
                    <div class="collaborator-item">
                        <span class="collaborator-name">${collaborator.name || collaborator.username}</span>
                        <span class="collaborator-role">${collaborator.role || '협업자'}</span>
                        <span class="collaborator-permissions">${permissionsText}</span>
                    </div>
                `;
            }).join('');
            
            collaboratorsList.innerHTML = collaboratorsHtml;
        }

        // 테스트 1: 공동작업자 렌더링 테스트
        function testRenderCollaborators() {
            const resultArea = document.getElementById('render-test-result');
            
            // 테스트용 공동작업자 데이터
            const testCollaborators = [
                {
                    user_id: 1,
                    username: "user1",
                    name: "김철수",
                    can_edit: true,
                    can_delete: false,
                    can_complete: true,
                    can_share: true,
                    role: "collaborator",
                    added_at: "2025-01-01T00:00:00"
                },
                {
                    user_id: 2,
                    username: "user2",
                    name: "이영희",
                    can_edit: true,
                    can_delete: true,
                    can_complete: true,
                    can_share: false,
                    role: "manager",
                    added_at: "2025-01-02T00:00:00"
                }
            ];

            // 테스트용 HTML 생성
            const testHTML = `
                <div class="schedule-info-table">
                    <div class="schedule-info-label">프로젝트명</div>
                    <div class="schedule-info-value">테스트 프로젝트</div>
                    <div class="schedule-info-label">일정명</div>
                    <div class="schedule-info-value">테스트 일정</div>
                    <div class="schedule-info-label">작성자</div>
                    <div class="schedule-info-value">홍길동</div>
                    <div class="schedule-info-label">공동작업자</div>
                    <div class="schedule-info-value" id="collaborators-list">
                        <div class="loading-collaborators">로딩 중...</div>
                    </div>
                </div>
            `;

            resultArea.innerHTML = testHTML;
            
            // 공동작업자 렌더링 테스트
            setTimeout(() => {
                renderCollaboratorsForModal(testCollaborators, 1);
                resultArea.innerHTML += '<p style="color: green; margin-top: 10px;">✅ 공동작업자 렌더링 테스트 완료!</p>';
            }, 1000);
        }

        // 테스트 2: 스케줄 상세 정보 테스트
        function testScheduleDetail() {
            const resultArea = document.getElementById('schedule-detail-result');
            
            const testSchedule = {
                id: 1,
                title: "테스트 스케줄",
                project_name: "테스트 프로젝트",
                owner: { name: "홍길동" },
                priority: "high",
                due_time: "2025-01-15T14:00:00",
                alarm_time: "2025-01-15T13:00:00",
                is_completed: false,
                individual: false,
                content: "이것은 테스트 스케줄입니다."
            };

            const scheduleDetailHTML = `
                <div class="schedule-info-table">
                    <div class="schedule-info-label">프로젝트명</div>
                    <div class="schedule-info-value">${testSchedule.project_name}</div>
                    <div class="schedule-info-label">일정명</div>
                    <div class="schedule-info-value">${testSchedule.title}</div>
                    <div class="schedule-info-label">작성자</div>
                    <div class="schedule-info-value">${testSchedule.owner.name}</div>
                    <div class="schedule-info-label">공동작업자</div>
                    <div class="schedule-info-value" id="collaborators-list-2">
                        <div class="loading-collaborators">로딩 중...</div>
                    </div>
                    <div class="schedule-info-label">우선순위</div>
                    <div class="schedule-info-value">${testSchedule.priority}</div>
                    <div class="schedule-info-label">마감시간</div>
                    <div class="schedule-info-value">${testSchedule.due_time}</div>
                    <div class="schedule-info-label">알람시간</div>
                    <div class="schedule-info-value">${testSchedule.alarm_time}</div>
                    <div class="schedule-info-label">상태</div>
                    <div class="schedule-info-value">${testSchedule.is_completed ? '완료' : '미완료'}</div>
                    <div class="schedule-info-label">개인일정</div>
                    <div class="schedule-info-value">${testSchedule.individual ? '🔒 개인일정' : '공개일정'}</div>
                    <div class="schedule-info-label">내용</div>
                    <div class="schedule-info-value">${testSchedule.content}</div>
                </div>
            `;

            resultArea.innerHTML = scheduleDetailHTML;
            
            // 공동작업자 데이터 시뮬레이션
            setTimeout(() => {
                const emptyCollaborators = [];
                renderCollaboratorsForModal(emptyCollaborators, 1);
                
                // collaborators-list-2를 찾아서 업데이트
                const collaboratorsList2 = document.getElementById('collaborators-list-2');
                if (collaboratorsList2) {
                    if (emptyCollaborators.length === 0) {
                        collaboratorsList2.innerHTML = '<span class="no-collaborators">공동작업자가 없습니다</span>';
                    }
                }
                
                resultArea.innerHTML += '<p style="color: green; margin-top: 10px;">✅ 스케줄 상세 정보 테스트 완료!</p>';
            }, 1000);
        }

        // 테스트 3: API 호출 시뮬레이션
        function testAPICall() {
            const resultArea = document.getElementById('api-test-result');
            
            resultArea.innerHTML = '<p>API 호출 시뮬레이션 중...</p>';
            
            // 가상의 API 응답 시뮬레이션
            setTimeout(() => {
                const mockResponse = {
                    status: 200,
                    data: [
                        {
                            user_id: 3,
                            username: "user3",
                            name: "박민수",
                            can_edit: true,
                            can_delete: true,
                            can_complete: true,
                            can_share: true,
                            role: "admin",
                            added_at: "2025-01-03T00:00:00"
                        }
                    ]
                };

                if (mockResponse.status === 200) {
                    const collaborators = mockResponse.data;
                    resultArea.innerHTML = `
                        <p style="color: green;">✅ API 호출 성공!</p>
                        <p>응답 데이터:</p>
                        <pre>${JSON.stringify(collaborators, null, 2)}</pre>
                        <p>공동작업자 수: ${collaborators.length}명</p>
                    `;
                } else {
                    resultArea.innerHTML = '<p style="color: red;">❌ API 호출 실패</p>';
                }
            }, 1500);
        }
    </script>
</body>
</html>
